<font face=å®‹ä½“ size=12 color=green><center>
 Robomaster-Cæ¿å¼€å‘ç¼–ç¨‹ç¯å¢ƒé…ç½®æ•™ç¨‹</font></center>

<font face=å®‹ä½“ size=8 color=green><center>
1024ç”µæ§ç»„
</font></center>

--- 

# åŸºç¡€ç¯å¢ƒ : 

## å‰ç½®

**VScode + CubeMX + MinGW-gcc + arm-none-eabi-gcc + makefile + openocd**


*åŸºäºVScode CubeMX MingW-gcc å·²ç»éƒ¨ç½²å®Œæ¯•(èƒ½æ­£å¸¸æ‰§è¡Œ.cæ–‡ä»¶ä»£è¡¨å·²ç»éƒ¨ç½²)ï¼Œä»¥ä¸‹ä»…å®‰è£…å‰©ä½™éƒ¨åˆ†*  ~~(å…¶å®æ˜¯æ‡’å¾—å†™)~~

### å®‰è£…

**arm-none-eabi-gcc**å’Œ **openocd**

<font size=2>ä¸‹è½½zipè§£å‹å³å¯ï¼Œä¸ç”¨ä¸‹è½½å®‰è£…åŒ…</font>
- [arm-gcc](https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads)
- [openocd](https://gnutoolchains.com/arm-eabi/openocd/)

2. å°†å…¶æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­
- arm-gnu-toolchain/bin(æ³¨æ„ä¸æ˜¯arm-none-eabi/bin)
- openocd/OPENOCD/bin
- æ–°å»ºä¸€ä¸ª**OPENOCD_SCRIPTS**,è·¯å¾„ä¸ºOpenOCD\share\openocd\scripts
  
3. æ ¡éªŒåŸºç¡€ç¯å¢ƒæ˜¯å¦é…ç½®å®Œæ¯• 
   
- æ‰“å¼€ç»ˆç«¯(ç®¡ç†å‘˜èº«ä»½) 
- è¾“å…¥***make -j8 make***: å‡ºç°  *No targets specified and no makefile found.  Stop.*

- è¾“å…¥***openocd --version***: å‡ºç°Openocdçš„ç‰ˆæœ¬ä¿¡æ¯

- è¾“å…¥***arm-none-aebi-gcc.exe*** (tabé”®è‡ªåŠ¨è¡¥å…¨) :å‡ºç°arm-eabiçš„ç‰ˆæœ¬ä¿¡æ¯
  
---

### å‡†å¤‡å·¥ä½œ

1. ä½¿ç”¨**CubeMX**å¯¼å‡º**makefile**æ–‡ä»¶

2. å®‰è£…VScodeæ’ä»¶

- [x] C/C++
- [x] C/C++ Extension Pack
- [x] Makefile Tools
- [x] Cortex-Debug


## ç¼–è¯‘æ„å»º :

1. æ‰“å¼€VScodeï¼Œåœ¨å‘½ä»¤æ§åˆ¶å°ä¸­è¾“å…¥C/C++(UI)é…ç½®ç¼–è¯‘ç¯å¢ƒ,ä¹Ÿå¯ä»¥ä½¿ç”¨å¿«æ·é”®Ctrl+Shift+Pï¼Œè¿™ä¸€æ­¥ä¼šç”Ÿæˆ**cpp.json**æ–‡ä»¶ 

2. åœ¨ç»ˆç«¯ä¸­è¾“å…¥ ***make -j8*** è¿›è¡Œç¼–è¯‘æ„å»º

*å‡ºç°ä»¥ä¸‹ç•Œé¢è¯´æ˜æ„å»ºæˆåŠŸï¼Œæ„å»ºæˆåŠŸåä¼šç”Ÿæˆbuildæ–‡ä»¶å¤¹*

![build complete]()

### è¡¥å……

è‹¥æ— æ³•æ­£å¸¸æ„å»ºåˆ™å¯èƒ½æ˜¯ä»¥ä¸‹å‡ ä¸ªé—®é¢˜

- .hæ–‡ä»¶æœªåŒ…å«

- å‰ç½®æœªå®Œæˆ

---

## çƒ§å½• ï¼š
<font size="5">ç¼–å†™taskä»»åŠ¡è°ƒç”¨openocdå‘½ä»¤æ‰§è¡Œä¸‹è½½ä»»åŠ¡</font>

åœ¨VScodeä¸­æ‰¾åˆ°ç»ˆç«¯ï¼Œç‚¹å‡»é…ç½®ä»»åŠ¡ï¼Œæ–°å»ºOtherä»»åŠ¡ï¼Œåœ¨å·¦ä¾§.vscodeæ–‡ä»¶å¤¹ä¸‹äº§ç”Ÿ*task.json*æ–‡ä»¶

### ä»¥ä¸‹æ˜¯*task.json*ä»»åŠ¡çš„ç¼–å†™

``` 

{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Download",
            "type": "shell",
            "command": "openocd",
            "args": [
                "-f",
                "D:/Toolchain/openocd/OpenOCD/share/openocd/scripts/interface/stlink.cfg",
                "-f",     //é€‰æ‹©ä¸‹è½½å™¨
                "D:/Toolchain/openocd/OpenOCD/share/openocd/scripts/target/stm32f1x.cfg",
                "-c",     //é€‰æ‹©èŠ¯ç‰‡å‹å·

                "program build/XXX.hex verify reset exit"    
                 //buildæ–‡ä»¶å¤¹ä¸‹çš„.hexæ–‡ä»¶
            

            ],
            "problemMatcher":[
                "$gcc"
            ],

            "group": {
                "kind": "build",
                "isDefault": true
            }
        }       
```

å®Œæˆtask.jsonçš„ç¼–å†™åï¼Œç‚¹å‡»ç»ˆç«¯->è¿è¡Œç”Ÿæˆä»»åŠ¡->Download æ‰§è¡Œä¸‹è½½ä»»åŠ¡æˆ–ä½¿ç”¨é»˜è®¤å¿«æ·é”®Shift + Ctrl +B æ‰§è¡Œ

### è¡¥å……

1. //program [file] [address] [verify] [reset] [exit]
          æ–‡ä»¶å¤¹    åœ°å€      æ ¡éªŒ     å¤ä½    é€€å‡º

2. è‹¥æ— æ³•æ­£å¸¸æ‰§è¡Œä¸‹è½½ä»»åŠ¡ï¼Œå¯èƒ½æ˜¯èŠ¯ç‰‡flashå‹å·é—®é¢˜
- æŸ¥è¯¢è‡ªå·±çš„èŠ¯ç‰‡å‹å·
- æ‰¾åˆ°OpenOCD\share\openocd\scripts\targetä¸‹çš„å¯¹åº”.cfgæ–‡ä»¶ï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œæ‰¾åˆ°XXX,ä¿®æ”¹XXXä¸ºXXX(è‡ªå·±èŠ¯ç‰‡æ‰€å¯¹åº”çš„å‹å·)

3. å¯ä»¥å°†
    >"group": {
                "kind": "build",
                "isDefault": true
    }

è¿™ä¸€éƒ¨åˆ†æ”¹ä¸º
    
  > "group":"build"

ä¸¤è€…åŒºåˆ«ä¸ºï¼šå‰è€…å°†è¯¥ä»»åŠ¡åŠ å…¥ä»»åŠ¡ç»„å¹¶è®¾ä¸ºé»˜è®¤å¿«æ·é”®æ‰§è¡Œï¼Œåè€…ä»…å°†å…¶åŠ å…¥ä»»åŠ¡ç»„ 

~~å…·ä½“æƒ…å†µå¯ä»¥è‡ªå·±è¯•è¯•ï¼Œæ¯•ç«Ÿå®è·µå‡ºçœŸçŸ¥~~

4. çƒ§å½•æˆåŠŸ

![download]()

---

## è°ƒè¯•(éœ€è¦Cortex-Debugæ’ä»¶)

1. å·¦ä¾§ä»»åŠ¡æ -> è¿è¡Œä¸è°ƒè¯•-> æ–°å»ºlaunch.jsonæ–‡ä»¶-> é€‰æ‹©è°ƒè¯•å™¨C++(GDB)

2. åœ¨.vscodeä¸‹æ‰¾åˆ°launch.jsonæ–‡ä»¶ï¼Œç‚¹å‡»å³ä¸‹è§’çš„æ·»åŠ é…ç½®ï¼Œé€‰æ‹©Cortex Debug ï¼šOpenocd (ä¼šè‡ªåŠ¨ç”Ÿæˆæ¨¡ç‰ˆï¼Œä¸‹é¢åªéœ€æ”¹ä¸‹æ¨¡ç‰ˆ)

3. ç¼–å†™launch.jsonæ–‡ä»¶

- æ›´æ”¹"executable"
- æ·»åŠ "configFiles"(ç›´æ¥copy *task.json*æ–‡ä»¶é‡Œé¢çš„)
- åˆ å»showDevDebugOutput"(ä¸‹é¢æœ‰è®²why)

```
{
    "version": "0.2.0",
    "configurations": [
        
        {
            "cwd": "${workspaceRoot}",
            "executable": "./build/XXX.elf",
            //è‡ªå·±buildæ–‡ä»¶å¤¹ä¸‹çš„.elfæ–‡ä»¶
            "name": "Debug with OpenOCD",
            "request": "launch",
            "type": "cortex-debug",
            "servertype": "openocd",
            "configFiles": [
                "D:/Toolchain/openocd/OpenOCD/share/openocd/scripts/interface/stlink.cfg",
            //é€‰æ‹©ä¸‹è½½å™¨

                "D:/Toolchain/openocd/OpenOCD/share/openocd/scripts/target/stm32f1x.cfg",
            //é€‰æ‹©èŠ¯ç‰‡å‹å·

            ],
            "searchDir": [],
            "runToEntryPoint": "main",
         
        //æ³¨æ„è¿™é‡Œæ³¨é‡Šäº†è¿™ä¸€å¥
        //"showDevDebugOutput": "none"  
        }

    ]
}

```

### è¡¥å……

- "showDevDebugOutput": "none"ä½œç”¨æ˜¯æ§åˆ¶æ˜¯å¦æ˜¾ç¤º OpenOCD æˆ–è°ƒè¯•è¿‡ç¨‹ä¸­å¼€å‘è°ƒè¯•è¾“å‡ºï¼Œå¦‚æœä½ åªå…³å¿ƒç¨‹åºçš„æ‰§è¡Œè€Œä¸æƒ³çœ‹åˆ°å†—ä½™çš„è°ƒè¯•ç»†èŠ‚ï¼Œåˆ™å¯ä»¥å°†å…¶å–æ¶ˆæ³¨é‡Šï¼Œå¦‚æœä½ æƒ³ä¿æŒopenocdé»˜è®¤çš„è°ƒè¯•è¾“å‡º(å°½ç®¡å¯èƒ½æœ‰äº›å†—æ‚éƒ¨åˆ†),é‚£å°±å°†å…¶æ³¨é‡Šã€‚æˆ‘æ›´æ¨èå°†å…¶æ³¨é‡Š

- è°ƒè¯•æˆåŠŸ

![success]()

---

# è¡¥å……

## æ–°å»ºæ–‡ä»¶å¤¹

å¦‚æœè¦è‡ªå·±æ–°åŠ æ–‡ä»¶å¤¹ï¼Œegï¼šHardwareï¼ŒUserè¯·æŒ‰ç…§è§„èŒƒ
- Hardware/Inc å­˜æ”¾.hæ–‡ä»¶
- Hardware/Src å­˜æ”¾.cæ–‡ä»¶

æ­¤å¤„åº”å½“æœ‰ä¸¤ä¸ªåœ°æ–¹è¦ä¿®æ”¹
1. æ‰“å¼€ä½ çš„Makefileæ–‡ä»¶ï¼Œæ‰¾åˆ° C_INCLUDESï¼Œåœ¨æœ€åæ·»åŠ ä¸Šä½ çš„.hæ–‡ä»¶å­˜æ”¾è·¯å¾„ï¼Œå¦‚ä¸‹

```

C_INCLUDES =  \
-ICore/Inc \
-IDrivers/STM32F1xx_HAL_Driver/Inc/Legacy \
-IDrivers/STM32F1xx_HAL_Driver/Inc \
-IDrivers/CMSIS/Device/ST/STM32F1xx/Include \
-IDrivers/CMSIS/Include \

```
æ³¨æ„è¿™é‡Œè¦è¡¥ä¸Šä¸€ä¸ªåæ–œæ \

ç„¶ååŠ ä¸Šä½ çš„.hæ–‡ä»¶å­˜æ”¾è·¯å¾„ï¼ˆè¿™ä¸€æ•´ä¸ªæ–‡ä»¶å¤¹ï¼‰

`-IHardware/Inc`

æ³¨æ„è¿™é‡Œæœ«å°¾ä¸ç”¨è¡¥åæ–œæ 

2. åœ¨Makefileä¸‹ï¼Œæ‰¾åˆ°C_SOURCESï¼Œåœ¨æœ€åæ·»åŠ ä¸Šä½ çš„.cæ–‡ä»¶ï¼Œè¿‡ç¨‹ä¸.hç±»ä¼¼ï¼Œå°±å±•ç¤ºå®Œæˆåçš„ä»£ç ï¼Œå¦‚ä¸‹

```
C_SOURCES =  \
Core/Src/main.c \
Core/Src/gpio.c \
Core/Src/stm32f1xx_it.c \
Core/Src/stm32f1xx_hal_msp.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_gpio_ex.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_rcc.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_rcc_ex.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_gpio.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_dma.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_cortex.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_pwr.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_flash.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_flash_ex.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_exti.c \
Core/Src/system_stm32f1xx.c \
Core/Src/sysmem.c \
Core/Src/syscalls.c \
Core/Src/i2c.c \
Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_i2c.c \

```

`Hardware/Src/OLED.c`

è¡¥å……
è‹¥æœ‰å¤šä¸ª.hå’Œ.cæ–‡ä»¶å¾…æ·»åŠ 
- .hæ–‡ä»¶åªè¦æ·»åŠ æ•´ä¸ªæ–‡ä»¶å¤¹è·¯å¾„å³å¯
- .cæ–‡ä»¶è¦æ·»åŠ æ¯ä¸€ä¸ªæ–‡ä»¶

3. æ‰“å¼€.vscode/c_cpp_properties.json,åœ¨"includePath"ä¸­æ·»åŠ ä¸Šä½ çš„.hæ–‡ä»¶å­˜æ”¾è·¯å¾„ï¼Œå¦‚ä¸‹

```

"includePath": [
                "${workspaceFolder}/**",
                "${workspaceFolder}/Hardware/Inc"

            ],

```

å¦‚æœè¿˜æ˜¯æŠ¥é”™ï¼Œè¯·æŸ¥æ‰¾ä½ çš„.hæ–‡ä»¶æ˜¯å¦è¢«åŒ…å«ï¼ŒæŠ¥é”™åŸå› å¤§æ¦‚ç‡æ˜¯è¿™ä¸ª

# å…¶ä»–(å…¶å®æ²¡ä»€ä¹ˆç”¨ï¼Œä½†å¯ä»¥æ•´æ´»)

## ç¼–å†™ä¸€ä¸ªæ‰§è¡ŒmakeæŒ‡ä»¤çš„ä»»åŠ¡

```

        {
            "label": "build",
            "type": "shell",
            "command": "make",
            "args": [],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": ["$gcc"],
            "detail": "Generated task"
        },
        {
            "label": "clean",
            "type": "shell",
            "command": "make",
            "args": ["clean"],
            "group": "build",
            "problemMatcher": []
        }
    ]
}

```

## è‡ªå®šä¹‰

ä»¥ä¸‹æ˜¯æ­é…Task Buttonæ’ä»¶ä»¥æé«˜ä½“éªŒæ„Ÿ

åœ¨.vscodeä¸‹çš„setting.jsonæ–‡ä»¶ä¸­ç¼–å†™
(å®é™…å†…å®¹å¯ä»¥å‚è€ƒTask Buttonæ’ä»¶çš„ç®€ä»‹ï¼Œä»¥ä¸‹ä»…ä¾›å‚è€ƒ)

```
 Task Button
{
  "folders": [
    {
      "path": ".."
    }
  ],
  "settings": {
    "VsCodeTaskButtons.showCounter": true,
    "VsCodeTaskButtons.tasks": [
      {
       "label": "ğŸ¤˜ğŸ‘½ğŸ¤˜ build",
       "task": "build",
       "tooltip": "Start the \"build\" task"
      },
      {
        "label": "ğŸ–•ğŸ¤¡ğŸ–• Download",
       "task": "Download",
       "tooltip": "Start the \"Download\" task"
      },
    ]
  },
  
}

```

æ¨èä¸€ä¸ªæœ‰è¶£çš„å°ç½‘ç«™,ç”±äºå…¶é‡‡å–ç¡¬ç¼–ç æ ¼å¼ï¼Œæ•…å¯ä»¥éšæ„copy
[â˜ï¸ğŸ¥¸emoji](https://emojipedia.org/)
